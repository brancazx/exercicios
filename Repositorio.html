<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√çndice de Arquivos ‚Äî brancazx/exercicios</title>
  <style>
    :root {
      --bg: #1a1a1a;
      --panel: #2a2a2a;
      --text: #f0f0f0;
      --muted: #cccccc;
      --accent: #ff6b6b;
      --chip: #333333;
      --border: #444444;
    }
    body { margin: 0; font-family: system-ui, sans-serif; background: linear-gradient(180deg, var(--bg), #000); color: var(--text); }
    header { position: sticky; top: 0; z-index: 5; backdrop-filter: blur(8px); background: rgba(42,42,42,.9); border-bottom: 1px solid var(--border); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    h1 { margin: 0; font-size: 1.4rem; display: flex; gap: .6rem; }
    .controls { display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-top: 12px; }
    .search input { width: 100%; background: var(--chip); border: 1px solid var(--border); padding: 10px 12px; border-radius: 12px; color: var(--text); }
    .btn { background: var(--accent); color: #fff; border: 0; padding: 10px 14px; border-radius: 12px; font-weight: 700; cursor: pointer; }
    .btn:disabled{ opacity:.5; cursor:not-allowed }
    ul.files { list-style: none; padding: 0; margin: 0; }
    ul.files li { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; padding: 6px 8px; border-bottom: 1px dashed rgba(255,255,255,.06); }
    .path { font-family: monospace; font-size: .95rem; }
    .row-actions { display: inline-flex; gap: 6px; }
    .row-actions a { text-decoration: none; font-size: .85rem; padding: 6px 10px; border-radius: 10px; border: 1px solid var(--border); background: #333; color: var(--text); }
    .row-actions a:hover{ background:#444 }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>
        üìÅ √çndice de Arquivos
        <small>GitHub ‚Üí <code id="repoLabel">brancazx/exercicios</code></small>
      </h1>
      <div class="controls">
        <input id="q" type="search" placeholder="Filtrar por nome, extens√£o‚Ä¶" />
        <button id="reload" class="btn">Atualizar</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="card">
        <div class="content">
          <div id="tree"></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="wrap">
    Feito com ‚ù§Ô∏è usando a API p√∫blica do GitHub.
  </footer>

  <script>
    const OWNER = "brancazx";
    const REPO  = "exercicios";
    const BRANCH = "main";

    const state = { flat: [], query: "" };

    function extOf(path) {
      const m = path.toLowerCase().match(/\.([^.\/]+)$/);
      return m ? `.${m[1]}` : "";
    }

    function matchesQuery(path) {
      const q = state.query.trim().toLowerCase();
      if (!q) return true;
      return path.toLowerCase().includes(q);
    }

    document.getElementById("q").addEventListener("input", e => {
      state.query = e.target.value;
      render();
    });

    document.getElementById("reload").addEventListener("click", () => loadRepo());

    async function gh(path="") {
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}?ref=${BRANCH}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("Erro: "+url);
      return res.json();
    }

    async function crawl(dir="") {
      const items = await gh(dir);
      let out = [];
      for (const it of items) {
        if (it.type === "file") {
          out.push(it);
        } else if (it.type === "dir") {
          const children = await crawl(it.path);
          out = out.concat(children);
        }
      }
      return out;
    }

    function ghPagesUrl(path) {
      return `https://${OWNER}.github.io/${REPO}/${path}`;
    }

    async function checkReactFile(file) {
      try {
        const res = await fetch(file.download_url);
        const code = await res.text();
        return code.includes("import React") || code.includes("from 'react'");
      } catch {
        return false;
      }
    }

    async function openInSnack(file) {
      try {
        const res = await fetch(file.download_url);
        const code = await res.text();
        const encoded = encodeURIComponent(code);
        const url = `https://snack.expo.dev/embedded?platform=web&name=${encodeURIComponent(file.name)}&files[App.js]=${encoded}`;
        window.open(url, "_blank");
      } catch (e) {
        alert("Erro ao abrir no Snack: " + e.message);
      }
    }

    async function render() {
      const host = document.getElementById("tree");
      host.innerHTML = "";
      const ul = document.createElement("ul");
      ul.className = "files";

      for (const f of state.flat.filter(f => matchesQuery(f.path)).sort((a,b)=>a.path.localeCompare(b.path))) {
        const li = document.createElement("li");
        const left = document.createElement("div");
        const right = document.createElement("div");
        right.className = "row-actions";

        left.innerHTML = `<span class="path">${f.path}</span>`;

        const aRaw = document.createElement("a");
        aRaw.href = f.download_url;
        aRaw.target = "_blank";
        aRaw.textContent = "RAW";

        const aHub = document.createElement("a");
        aHub.href = f.html_url;
        aHub.target = "_blank";
        aHub.textContent = "GitHub";

        right.append(aRaw, aHub);

        if (extOf(f.path) === ".html") {
          const aPages = document.createElement("a");
          aPages.href = ghPagesUrl(f.path);
          aPages.target = "_blank";
          aPages.textContent = "Pages";
          right.appendChild(aPages);
        }

        if (extOf(f.path) === ".js") {
          // verificar se √© React
          checkReactFile(f).then(isReact => {
            if (isReact) {
              const aSnack = document.createElement("a");
              aSnack.href = "#";
              aSnack.textContent = "Snack Expo";
              aSnack.onclick = ev => { ev.preventDefault(); openInSnack(f); };
              right.appendChild(aSnack);
            }
          });
        }

        li.append(left, right);
        ul.appendChild(li);
      }

      host.appendChild(ul);
    }

    async function loadRepo() {
      const btn = document.getElementById("reload");
      btn.disabled = true; btn.textContent = "Carregando‚Ä¶";
      try {
        state.flat = await crawl("");
        render();
      } catch (e) {
        alert(e.message);
      } finally {
        btn.disabled = false; btn.textContent = "Atualizar";
      }
    }

    loadRepo();
  </script>
</body>
</html>
